// backend/server.js
const express = require("express");
const multer = require("multer");
const mongoose = require("mongoose");
const cors = require("cors");
const app = express();
const PORT = 5000;

// MongoDB setup
mongoose.connect("mongodb://localhost:27017/3dprinting", {
    useNewUrlParser: true,
    useUnifiedTopology: true,
});
const Order = mongoose.model("Order", {
    filename: String,
    date: { type: Date, default: Date.now },
});

// File upload setup
const storage = multer.diskStorage({
    destination: "uploads/",
    filename: (req, file, cb) => cb(null, file.originalname),
});
const upload = multer({ storage });

app.use(cors());
app.use(express.json());

// Routes
app.post("/upload", upload.single("file"), async (req, res) => {
    const order = new Order({ filename: req.file.originalname });
    await order.save();
    res.json({ message: "File uploaded successfully!" });
});

app.get("/orders", async (req, res) => {
    const orders = await Order.find();
    res.json(orders);
});

app.listen(PORT, () => console.log(`Server running on port ${PORT}`));

// frontend/pages/index.js
import { useState } from "react";
import axios from "axios";
import { STLViewer } from "react-stl-viewer";

export default function Home() {
    const [file, setFile] = useState(null);
    const [orders, setOrders] = useState([]);

    const handleFileChange = (e) => setFile(e.target.files[0]);
    const handleUpload = async () => {
        const formData = new FormData();
        formData.append("file", file);
        await axios.post("http://localhost:5000/upload", formData);
        alert("File uploaded!");
    };

    return (
        <div>
            <h1>3D Printing Service</h1>
            <input type="file" accept=".stl" onChange={handleFileChange} />
            <button onClick={handleUpload}>Upload</button>
            {file && <STLViewer url={URL.createObjectURL(file)} width={400} height={400} />} 
        </div>
    );
}
